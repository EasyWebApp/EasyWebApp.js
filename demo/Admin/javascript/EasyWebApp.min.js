"function"==typeof this.define&&this.define.amd||(this.define=function(){return arguments[arguments.length-1]()}),define("EasyWebApp",function(){var t;t=function(t,e,i){function n(t,e){i.ListView(this,function(){e.call(arguments[0],arguments[1])}).clear().render(t)}function r(t){var e=arguments.callee;return t instanceof Array?n.call(this[0],t,e):void this.value("name",function(i){return t[i]instanceof Array?void n.call(this,t[i],e):t[i]})}i.fn.extend({dataRender:function(t){return t instanceof Array?n.call(i.ListView.findView(this,!0)[0],t,r):r.call(this,t),this},dataReader:function(){var t=i("[name]",this[0]).not(i("[name] [name]",this[0])),e={};if(!t[0])return this.value();for(var n,r,a=0;a<t.length;a++)if(n=t[a].getAttribute("name"),r=i.ListView.getInstance(t[a])){e[n]=[];for(var s=0;s<r.length;s++)e[n][s]=i.extend(r.valueOf(s),arguments.callee.call(r[s]))}else e[n]=arguments.callee.call(i(t[a]));return e}})}(self,self.document,self.jQuery),t=function(t,e,i){function n(t,e,n,r){switch(this.ownApp=t,this.$_DOM=i.isPlainObject(e)?this.createDOM(e,n,r):i(e),this.$_DOM.data("EWA_PageLink",this),i.extend(this,arguments.callee.getAttr(this.$_DOM)),this.target){case"_top":this.type="Outer";break;case"_blank":this.type="Data";break;case"_self":default:this.href&&(this.type="Inner")}this.method=(this.method||"Get").toLowerCase(),this.data={},this.href=this.href||this.ownApp.history.last().HTML,this.href=this.getURL("href");var a=i.fileName(this.href).split(".");i.extend(this.data,{_File_Path_:i.filePath(this.href),_File_Name_:a[0],_Ext_Name_:a[1]}),(this.href||"").indexOf("?")>-1&&(this.data=i.extend(i.paramJSON(this.href),this.data))}function r(n,r){i.extend(this,{ownerApp:n,sourceLink:r,title:r.title||e.title,URL:r.alt||t.location.href,HTML:r.href||e.URL,method:r.method,JSON:r.src||r.action,time:i.now(),innerLink:[],innerTemplate:[]})}function a(){var t=i.extend(this,{length:0,ownerApp:arguments[0],root:arguments[1],lastIndex:-1});d.on("popstate",function(){var e=arguments[0].state,i=t[(e||{}).DOM_Index];i&&(t.move(e),i.show().onReady(),t.prevIndex=t.lastIndex,t.lastIndex=e.DOM_Index)})}function s(t,e){var n=i.makeArray(arguments);return n.unshift(!0),n.slice(-1)[0]instanceof Array&&n.splice(1,0,[]),i.extend.apply(i,n)}function o(t,e,n,r){i.EventInterface.apply(this,["pageLoad","formSubmit","apiCall","pageRender","pageReady","appExit"]),i.extend(this,{domRoot:i(t),apiRoot:e||"",cache:n||0==n?n:1/0,urlChange:r,history:new a(this,t),loading:!1})}function h(){return i.inArray("nofollow",(this.getAttribute("rel")||"").split(/\s+/))>-1}function l(){var t=this.tagName.toLowerCase(),e=arguments.callee.caller.arguments[0];switch(e.type){case"click":case"tap":if("a"==t){if(h.call(this))return!0;e.preventDefault()}return t in g;case"change":return this!==e.target}}function c(){var e=i.split(t.location.hash,"!",2);if("#"==e[0]&&e[1]){this.findLink();var n=i('*[target="_self"][href="'+e[1]+'"]');return n[0]?n[0]["form"!=n[0].tagName.toLowerCase()?"click":"submit"]():this.ownerApp.loadLink(e[1]),e[1]}}n.getAttr=function(){return arguments[0].attr(["target","title","alt","href","method","src","action"])};var f=i.browser.modern?"prefetch":"next",p=i(e.body);n.prefetchClear=function(){i('head link[rel="'+f+'"]').remove()},i.extend(n.prototype,{createDOM:function(t,e,n){var r={};if(i.isPlainObject(e))for(var a in e)r["data-"+a]=e[a];var s=i("<button />",i.extend({style:"display: none",rel:"nofollow"},t,r)).appendTo(p);return(n instanceof Array||i.isPlainObject(n))&&s.data("EWA_Model",n),s},getData:function(){var t=this.$_DOM.data("EWA_Model");if(!t){var e=this.$_DOM.hasClass("ListView_Item")?this.$_DOM:this.$_DOM.parents(".ListView_Item");e[0]&&(t=i.ListView.getInstance(e[0].parentNode).valueOf(e))}return this.data=i.extend(t||{},this.data)},getArgs:function(){var t=i.extend(this.ownApp.history.getData(),this.getData());return i.map(this.$_DOM[0].dataset,function(e){return Number(e)%1!==0&&void 0!==t[e]?t[e]:e})},getURL:function(t){return this[t]?("href"==t&&"#"==this[t][0]||(this[t]=this.ownApp.makeURL(this[t]||"",this.getData(),("href"==t?!this.src:"GET"==this.method.toUpperCase())&&this.getArgs()),"href"==t&&"?"==this[t].slice(-1)&&(this[t]=this[t].slice(0,-1))),this[t]):""},valueOf:function(){var t={};for(var e in this)(typeof this[e]).match(/object|function/)||(t[e]=this[e]);return t}}),i.extend(r.prototype,{show:function(e){e=e?i(e):this.$_Page;var r=this.ownerApp.history,a=r.isForward(this);if(!e)return"Inner"!=this.sourceLink.type?t.setTimeout(function(){t.history[a?"forward":"back"]()}):(this.sourceLink=new n(this.ownerApp,this.sourceLink.valueOf()),this.sourceLink.$_DOM[0].click()),this;var s=this.sourceLink.getTarget();if((r.length||a)&&r.move(s),this.$_Page=e.appendTo(s).fadeIn(),!arguments.length){var o=r.last(!0).sourceLink.$_DOM[0],h=i.ListView.getInstance(o.parentElement);h?h.focus(o):o.scrollIntoView()}return this},valueOf:n.prototype.valueOf});var d=i(t);i.extend(a.prototype,{splice:Array.prototype.splice,push:Array.prototype.push,slice:Array.prototype.slice,indexOf:Array.prototype.indexOf,move:function(){if(i.isPlainObject(arguments[0]))var t=arguments[0];else{var e=arguments[0];i.ListView.findView(this.root,!0)}var n=(e||this.root).children().detach();return t&&t.DOM_Index+2!=this.length||(this[this.length-1].$_Page=this[this.length-1].$_Page||n),n},write:function(){this.prevIndex=this.lastIndex++,this.splice(this.lastIndex,this.length);var e=new r(this.ownerApp,arguments[0]||{});return this.push(e),e.$_Page=(this.cache()||{}).$_Page,t.history.pushState({DOM_Index:this.lastIndex},e.title,e.URL),e},cache:function(){for(var t=this[this.lastIndex],e=0;e<this.lastIndex;e++)if(t.time-this[e].time>1e3*this.ownerApp.cache)this[e].sourceLink.action||(this[e].$_Page=null);else if(!t.JSON&&i.isEqual(t.sourceLink,this[e].sourceLink))return this[e]},last:function(){var t=this[this.lastIndex]||{};return arguments[0]?t:t.valueOf()},prev:function(){var t=this[this.prevIndex]||{};return arguments[0]?t:t.valueOf()},isForward:function(){return this.indexOf(arguments[0])>this.indexOf(this.last(!0))},mergeData:function(t,e){var n=this.slice(e,e+1||void 0)[0];return n.data=i.extend(n.data||{},t instanceof i?i.paramJSON("?"+t.serialize()):t),t},getData:function(){var t=i.map(this,function(t){var e=t.data||t.sourceLink.data;return e&&[e]});return t.length<2?t[0]||{}:s.apply(null,t)}}),o.prototype=new i.EventInterface,o.prototype.constructor=o;var u=/\{(.+?)\}/g;o.prototype.makeURL=function(e,n,r){e=i.split(e,"?",2),n=i.extend(this.history.getData(),n||{});var a=("&"+e[1]).match(/&([^=]+)=\?/);a=a&&a[1];var s=i.param(i.extend(r||{},i.paramJSON("?"+e[1].replace(a+"=?",""))));return e=[t.decodeURIComponent(e[0]).replace(u,function(){return n[arguments[1]]}),a?[s,s?"&":"",a,"=?"].join(""):s].join("?"),e.match(/^(\w+:)?\/\/[\w\d]+/)||i.fileName(e).match(/\.(htm|html|md|markdown)$/)||(e=this.apiRoot+e),e},i.extend(n.prototype,{getTarget:function(){return this.target.match(/^_(self|blank)$/)?this.ownApp.domRoot:i('[name="'+this.target+'"]')},prefetch:function(){var t=(this.href||"").split("?");if("_self"==this.target&&-1==(t[1]||"").indexOf("=")){var n=i("<link />",{rel:f,href:this.href});this.method.match(/Get/i)&&this.src&&!this.src.match(u)&&i.isEmptyObject(this.$_DOM[0].dataset)&&n.add(i("<link />",{rel:f,href:this.getURL("src")})),n.appendTo(e.head)}return this},loadData:function(t){function e(e){e=a.trigger("apiCall",{method:r.method,URL:s||r.getURL("action"),data:e},a.history.last().HTML,a)||e,"function"==typeof t?t.call(r,e):a.history.mergeData(e,-1)}var n=i(this.$_DOM).parents("form").eq(0);n.length&&this.ownApp.history.mergeData(n,-1);var r=this,a=this.ownApp,s=this.getURL("src");if(!s)return e.call(this,this.getData());switch(this.method){case"get":i[this.method](s,e);break;case"post":case"put":case"delete":i[this.method](s,this.getArgs(),e)}}}),i.extend(r.prototype,{boot:function(t){function e(e){h=s(h,e),--l>0||(t.call(r,h),o.remove())}var r=this,a=i("head link[target][href]"),o=i("head link[src]");if(a.length&&this.ownerApp.one("pageReady",function(){return arguments[2].loadLink(a.remove().attr(["target","href"]),null,r.sourceLink.getData())}),!o.length)return t.call(this);for(var h={},l=o.length,c=0;c<o.length;c++)new n(this.ownerApp,o[c]).loadData(e)},getTemplate:function(t){return this.innerTemplate[t]||(this.innerTemplate[t]=i('*[id="'+t+'"]').remove(),i.ListView.findView(this.innerTemplate[t],!1)),this.innerTemplate[t].children().clone(!0)},load:function(e,n){var r=/\.(md|markdown)\??/i,a=this,s=this.ownerApp;return"#"==e.href[0]?n.call(this.show(this.getTemplate(e.href.slice(1))).ownerApp):void i.get(e.href,e.href.match(r)?function(e){"function"==typeof t.marked?a.show(t.marked(e)).$_Page.find("a[href]").attr("target",function(){return this.href.indexOf("#!")||h.call(this)?this.href.match(r)?"_self":"_top":(this.setAttribute("rel","nofollow"),arguments[1])}):s.domRoot.text(e),n.call(s)}:function(t){if("string"==typeof t){var e=t.match(/<\s*(html|head|body)(\s|>)/i),r=!t.match(/<\s*(link|script)(\s|>)/i),o=s.domRoot.selector;return!e&&r?a.show(t).boot(n):void p.sandBox(t,(o&&r?o:"body > *")+', link[rel="stylesheet"], link[target]',function(t){t=t.not("script[src]"),t.filter("link").appendTo("head");for(var e=t.filter("script"),r=0;r<e.length;r++)i.globalEval(e[r].text);return a.show(t.not("link, script")).boot(n),!1})}})}}),i.extend(n.prototype,{loadTemplate:function(){function t(){arguments[0]&&(n=arguments[0]),0==--a&&i.render(s,n).onReady()}var e=this.ownApp.trigger("pageLoad",this.ownApp.history.last(),this.ownApp.history.prev());if(e!==!1){this.ownApp.loading=!0;var i=this.ownApp.history.write(this);if(this.ownApp.cache&&i.$_Page)return i.show().onReady();var n,r="Inner"==this.type,a=r?2:1,s=this;this.loadData(t),r&&i.load(this,t)}},loadPage:function(){var e=this.ownApp.trigger("appExit",this.ownApp.history.last().HTML,this.href,this.getData());e!==!1&&(this.ownApp.history.move(),t.sessionStorage.EWA_Model=t.JSON.stringify(i.isPlainObject(e)?e:this.getData()),t.location.href=this.href+"?"+i.param(this.getArgs()))}}),i.extend(r.prototype,{render:function(t,e){var i=this.ownerApp;e=s(t&&t.getData(),e);var n=i.trigger("pageRender",i.history.last(),i.history.prev(),e);if(this.data=e=n||e,n!==!1){var r=i.domRoot;e instanceof Array?t&&"_self"!=t.target&&(r=t.getTarget().parent()):r=p,r.dataRender(e)}return this},findLink:function(t){for(var e,i=(this.ownerApp.history.lastIndex?this.ownerApp.domRoot:p).find("*[target]"),r=0;r<i.length;r++)e=new n(this.ownerApp,i[r]),this.innerLink.push(e),t&&e.prefetch();return i},onReady:function(){p.find("button[target]:hidden").remove();var t=this.ownerApp;return n.prefetchClear(),this.findLink(!0),t.loading=!1,t.trigger("pageReady",t.history.last(),t.history.prev(),t),t.domRoot.focus(),p.trigger({type:"loading",detail:1}),this}});var g=i.makeSet("form","input","textarea","select");return p.on((i.browser.mobile?"tap":"click")+" change","*[target]",function(){if(!l.call(this)){var t=i(this).data("EWA_PageLink");switch(t.target){case"_self":t.href&&t.loadTemplate();break;case"_blank":t.src&&t.loadData();break;case"_top":t.href&&t.loadPage();break;default:t.loadTemplate()}}}),o.prototype.loadLink=function(t,e,i){return"string"==typeof t&&(t={target:"_self",href:t,src:e},e=i,i=arguments[3]),this.loading=!1,(t instanceof n?t:new n(this,t,e,i)).$_DOM.click(),this},o.prototype.boot=function(){if(this.history.length)throw"This WebApp has been booted !";this.loading=!0;var t=new n(this,{target:""},null,arguments[0]),e=this.history.write(t,t.getTarget()),r=this;return p.on("submit","form:visible",function(){if(r.loading)return!1;var t=i(this).data("EWA_PageLink")||new n(r,this);r.history.mergeData(t.$_DOM,-1).attr("action",t.getURL("action"))}).ajaxSubmit(function(t){var e=r.trigger("formSubmit",r.history.last().HTML,arguments[2].url,t,i(this).attr("href"));e!==!1&&this.target&&r.loadLink(i.extend(n.getAttr(i(this)),{action:arguments[2].url}),null,e||t)}),c.call(e)||e.boot(function(){this.render(null,arguments[0]).onReady()}),d.on("hashchange",i.proxy(c,e)),this},o}(self,self.document,self.jQuery),t=function(t,e,i,n){i.fn.WebApp=function(){if(this[0]){var e=i(this[0]).data("_EWAI_");if(e instanceof n)return e;var r=i.makeArray(arguments),a=i.extend(i.parseJSON(t.sessionStorage.EWA_Model||"{ }"),i.paramJSON(),i.isPlainObject(r[0])&&r.shift()),s="string"==typeof r[0]&&r.shift(),o="number"==typeof r[0]&&r.shift(),h="boolean"==typeof r[0]&&r[0];return e=new n(this,s,o,h).boot(a),i(this[0]).data("_EWAI_",e).addClass("EWA_Container"),e}},i.fn.extend(i.map(i.makeSet.apply(i,i.map(["pageLoad","formSubmit","apiCall","pageRender","pageReady","appExit"],function(){return("on-"+arguments[0]).toCamelCase()})),function(t,e){return function(){var t=i.makeArray(arguments),n=i.type(t[0]).match(/String|RegExp/i)&&t.shift(),r=i.type(t[0]).match(/String|RegExp/i)&&t.shift(),a="function"==typeof t[0]&&t[0];return(n||r)&&a&&this.WebApp().on(e,function(t){var e=n&&r?2:1;if(n&&(t.HTML||"").match(n)&&e--,r&&(t.JSON||"").match(r)&&e--,!e){var s=i.makeArray(arguments);return s.unshift(s.pop()),a.apply(this,s)}}),this}}))}(self,self.document,self.jQuery,t)});
//# sourceMappingURL=EasyWebApp.min.map