!function(e){"function"==typeof define&&define.amd?define("EasyWebApp",["jquery","jQueryKit"],e):"object"==typeof module?module.exports=e(require("jquery"),require("jQueryKit")):this.EasyWebApp=e(this.jquery,this.jQueryKit)}(function(jquery,jQueryKit){var base_Observer=function(e){function Observer(t,i){return this.$_View=t instanceof e?t:e(t),this.setPrivate("handle",{}),this.init(i)}function basicMethod(t){var i=Observer.prototype.toString.call({constructor:t});return e.extend(t.prototype,{init:function(t){var n=this.$_View.data(i);return null!=n&&n!==this?n:e.data(this.$_View[0],i,this.setHandle(t))},setHandle:function(i){var n=this;return e.each(this.$_View[0].attributes,function(){var e=(this.nodeName.match(/^on(\w+)/i)||"")[1];!e||!(i||e in t.Bind_Event)||this.nodeName in this.ownerElement||Object.defineProperty(this.ownerElement,"on"+e,{set:function(t){n.off(e),"function"==typeof t&&n.on(e,t)},get:function(){return Observer.prototype.valueOf.call(n,e,"handler")[0]}})}),this},destructor:function(){return this.$_View.removeData(i),this.valueOf.apply(this,arguments)}}),e.extend(t,{Bind_Event:{},registerEvent:function(i){return e.extend(t.Bind_Event,e.makeSet.apply(e,arguments)),this},signSelector:function(){var t=this;return e.expr[":"][this.name.toLowerCase()]=function(){return(e.data(arguments[0],i)||"")instanceof t},this},instanceOf:function(t,n){for(var r,s=e(t)[0];s;){if((r=e.data(s,i))instanceof this)return r;s=!1!==n&&s.parentNode}}}).signSelector()}return basicMethod(e.Class.extend(Observer,{extend:function(t,i,n){return basicMethod(e.Class.extend.call(this,t,i,n))},getEvent:function(t){return e.extend({},"string"==typeof t?{type:t}:t,arguments[1])},match:function(t,i){var n;for(var r in i)switch(n=t[r]instanceof RegExp,e.Type(i[r])){case"RegExp":if(n){if(t[r].toString()!=i[r].toString())return;break}case"String":if(!(t[r]||"")[n?"test":"match"](i[r]))return;break;case"Function":if("function"!=typeof t[r])break;default:if(t[r]!==i[r])return}return i}},{toString:function(){return"[object "+this.constructor.name+"]"},valueOf:function(t,i){return t?i?e.map(this.__handle__[t],function(){return arguments[0][i]}):this.__handle__[t]:this.__handle__},on:function(t,i){t=Observer.getEvent(t,{handler:i});for(var n=this.__handle__[t.type]=this.__handle__[t.type]||[],r=0;n[r];r++)if(e.isEqual(n[r],t))return this;return n.push(t),this},emit:function(e,t){return e=Observer.getEvent(e),(this.__handle__[e.type]||[]).reduce(function(t,i){if(!Observer.match(e,i))return t;var n=i.handler.call(this,e,t);return null!=n?n:t}.bind(this),t)},off:function(t,i){return t=Observer.getEvent(t,{handler:i}),this.__handle__[t.type]=e.map(this.__handle__[t.type],function(e){return Observer.match(t,e)?null:e}),this},one:function(){var t=this,i=e.makeArray(arguments),n=i.slice(-1)[0];n="function"==typeof n&&i.pop();var r=new Promise(function(e){t.on.apply(t,i.concat(function once(){if(t.off.apply(t,i.concat(once)),n)return n.apply(this,arguments);e(arguments[1])}))});return n?this:r}}))}(jquery),view_RenderNode=function($){function RenderNode(e){$.extend(this,{ownerNode:e,raw:e.nodeValue||e.value,ownerElement:e.parentNode||e.ownerElement,type:0,value:null}).update(),this.scan()}function Eval(view,scope,expression){"use strict";try{var iValue=eval(expression);return null!=iValue?iValue:""}catch(e){return console.error(e),""}}return RenderNode.expression=/\$\{([\s\S]+?)\}/g,RenderNode.reference=/(\w+)(\.|\[(?:'|")|\()(\w+)?/g,RenderNode.rawName=/^(data\-|on)\w+/,RenderNode.Reference_Mask={view:1,this:4,scope:8},RenderNode.Template_Type=$.makeSet("Attr","Text","Comment"),$.extend(RenderNode.prototype=[],{constructor:RenderNode,update:function(){var e=this.ownerNode;if(e){var t=e.name;if(this.DOMType=$.Type(e),"Attr"===this.DOMType){var i=$.propFix[t]||t in e.ownerElement&&t;i?(this.name=i,this.DOMType="Prop"):this.name=t}}},add:function(e){e&&this.indexOf(e)<0&&this.push(e)},clear:function(){var e=this.ownerNode,t=this.raw.replace(RenderNode.expression,"");switch(this.DOMType){case"Text":case"Comment":return e.nodeValue=t;case"Attr":case"Prop":(e.value=t)||e.name.match(RenderNode.rawName)||(this.ownerElement.removeAttribute(e.name),this.ownerNode=null)}},scan:function(){var e=this;this.splice(0,1/0),this.type=0,this.raw=this.raw.replace(RenderNode.expression,function(t,i){return/\w+\s*\([\s\S]*?\)/.test(i)&&(e.type=2|e.type),i.replace(RenderNode.reference,function(t,i,n,r){if(self[i])return e.type=16|e.type;"("!==n[0]&&(e.type=e.type|RenderNode.Reference_Mask[i],"this"!==i&&e.add(r))}),"${"+i.trim()+"}"}),this[0]&&this.clear()},eval:function(e,t){null===this.value&&this.update();var i,n=this.ownerElement,r=this.raw.replace(RenderNode.expression,function(r,s,a,o){return i=Eval.call(n,e,t,s),r==o?o:i});return this.raw==r?i:r},render:function(e,t){var i=this.eval(e,t),n=this.ownerNode,r=this.ownerElement;if(i!==this.value)switch(this.value=i,this.DOMType){case"Text":n.previousSibling||n.nextSibling?n.nodeValue=i:r.innerHTML=i;break;case"Prop":if("style"!==this.name){r[this.name]=i instanceof Function?i.bind(e):i;break}case"Attr":n?n.value=i:r.setAttribute(this.name,i)}},toString:function(){return this.value+""}}),RenderNode}(jquery),InnerLink=function(e,t){function InnerLink(e){var i=t.call(this,e);return(i!==this?i:this).setProp()}return t.extend(InnerLink,{parsePath:function(e){var t;e=e.replace(/^\.\//,"").replace(/\/\.\//g,"/");do{t=(e=t||e).replace(/[^\.\/]+\/\.\.\//g,"")}while(t&&t!==e);return t},HTML_Link:"a[href], area[href], form[action]",Self_Link:"[data-href]:not(a, form)"},{setProp:function(){var e=this.$_View[0];return this.method=(e.getAttribute("method")||e.dataset.method||"Get").toUpperCase(),this.contentType=e.getAttribute("type")||e.getAttribute("enctype")||"application/x-www-form-urlencoded",this.charset=(e.getAttribute("charset")||e.acceptCharset||document.charset).split(/\s+/),this.setURI().title=e.title||document.title,/^(a|area|form)$/i.test(e.tagName)?this.href?this.target="page":this.target="data":this.target="view",this},setURI:function(){var t=this.$_View[0];return this.href=t.dataset.href||t.getAttribute(t.href?"href":"action"),this.src=this.href.split(/\?data=|&data=/),this.href=this.src[0],this.src=this.src[1],this.data=e.paramJSON(this.href),this.href=InnerLink.parsePath(this.href.split("?")[0]),this},toString:function(){var t=[e.param(this.data)];return t[0]||(t.length=0),this.src&&t.push("data="+this.src),t=t.join("&"),(this.href||"")+(t&&"?"+t)},loadData:function(){var t,i={method:this.method,url:this.src,beforeSend:arguments[0],contentType:this.contentType+"; charset="+this.charset[0],dataType:(this.src.match(/\?/g)||"")[1]?"jsonp":"json",complete:function(i){t=e.parseHeader(i.getAllResponseHeaders())}};switch(this.$_View[0].tagName.toLowerCase()){case"form":i.data=e.paramJSON("?"+this.$_View.serialize());break;case"area":case"a":i.data=e.extend({},this.$_View[0].dataset),delete i.data.method,delete i.data.autofocus}switch(this.contentType.split(";")[0]){case"multipart/form-data":e.extend(i,{data:new self.FormData(this.$_View[0]),contentType:!1,processData:!1});break;case"application/json":i.data=JSON.stringify(i.data),i.processData=!1}return Promise.resolve(e.ajax(i)).then(function(e){return{head:t,body:e}})},load:function(t){return Promise.all([this.href&&e.ajax({type:"GET",url:this.href,beforeSend:t}),this.src&&this.loadData(t)])},valueOf:function(){var e={};for(var t in this)this.hasOwnProperty(t)&&(e[t]=this[t]);return delete e.$_View,e.target=this.$_View[0],e}}).registerEvent("request","data")}(jquery,base_Observer),base_DataScope=function(e){function DataScope(e){return e instanceof DataScope?Object.create(e):this}return jquery.extend(DataScope.prototype,{commit:function(e,t){e=e.valueOf();var i={};for(var n in e)null==e[n]&&this.hasOwnProperty(n)&&this[n]===e[n]||(this[n]=i[n]=e[n]);return i},valueOf:function(){if(this.hasOwnProperty("length"))return Array.from(this,function(e){return e.valueOf()});var e={};for(var t in this)this.hasOwnProperty(t)&&(e[t]=this[t].valueOf());return e},insert:function(e,t){t=Math.min(t||0,this.length=this.hasOwnProperty("length")?this.length:0);for(var i=this.length;i>t;i--)this[i]=this[i-1];return this[t]=e,this.hasOwnProperty(this.length)&&this.length++,t}}),DataScope}(),view_View=function(e,t,i,n){function View(n,r,s){var a=t.call(e.Class.call(this,View,["render"]),n,!0);return a.setPrivate("base",s||View.baseOf(a.$_View[0])),a!==this?a:this.setPrivate({id:"",name:this.$_View[0].dataset.name,data:new i(r),parse:0,child:[],observer:null}).attach()}var r=[];return t.extend(View,{baseOf:function(t){if(t.dataset.href&&"?"!==t.dataset.href[0])return e.filePath(t.dataset.href)},getSub:function(t,i,n){for(var s=(t=e(t)).attr("is"),a=r.length-1;r[a];a--)if(s?s===r[a].name:r[a].is(t[0]))return new r[a](t,i||(this.instanceOf(t.parent())||"").__data__,n)},extend:function(t,i,n){return r.push(t),i=i||{},i.is=i.is||e.noop,e.Class.extend.call(this,t,i,n).signSelector()}},{attrWatch:function(){var t=this;this.__observer__=new self.MutationObserver(function(){var i={};e.each(arguments[0],function(){var t=this.target.getAttribute(this.attributeName);t==this.oldValue||(this.oldValue||"").match(n.expression)||(i[e.camelCase(this.attributeName.slice(5))]=t)}),t.__parse__&&!e.isEmptyObject(i)&&t.render(i).emit({type:"update",target:t.$_View[0]},i)}),this.__observer__.observe(this.$_View[0],{attributes:!0,attributeOldValue:!0,attributeFilter:e.map(Object.keys(this.$_View[0].dataset),function(){return"data-"+e.hyphenCase(arguments[0])})})},attach:function(){return this.$_View[0].id||(this.$_View[0].id=this.__id__||e.uuid("View")),this.__id__=this.$_View[0].id,this.$_View.data("[object View]",this),this.$_View[0].dataset.href&&this.attrWatch(),this.emit({type:"attach",target:this.$_View.append(this.$_Content)[0]}),this},detach:function(){return this.$_View[0].id.match(/^View_\w+/)&&(this.$_View[0].id=""),this.$_View.data("[object View]",null),this.__observer__&&(this.__observer__.disconnect(),delete this.__observer__),this.$_Content=this.$_View.children().detach(),this},scan:function(t){for(var i=[],n=this.$_View.treeWalker(function(e){var n;if(this.$_View[0]!==e&&1===e.nodeType){if(e.dataset.href)return t.call(this,e),n=View.getSub(e),this.__child__.indexOf(n)<0&&this.__child__.push(n),null;if(e.dataset.name||(n=View.instanceOf(e,!1)))return t.call(this,e),n||(n=View.getSub(e,null,this.__base__)),i.push(n.parse?n.parse():n),null;if(e.parentNode==document.head&&"title"!=e.tagName.toLowerCase())return null}return t.call(this,e)}.bind(this));!n.next().done;);for(var r=0;i[r];r++)t.call(this,i[r]);return this.__parse__=e.now(),this},watch:function(t,i){if(t in Object.getPrototypeOf(this)||"number"==typeof this.length&&e.isNumeric(t))throw ReferenceError('Inner Property "'+t+"\" can't be overwritten.");return this.setPublic(t,i,{get:function(){return this.__data__[t]},set:this.render.bind(this,t)}),this},valueOf:function(){return this.__data__.valueOf()},clear:function(){var e=this.valueOf(),t={};for(var i in e)e[i]instanceof Function||(t[i]="");return this.render(t)},childOf:function(t){var i=this.__child__||this;return t?e.map(i,function(e){return e.$_View.is(t)?e:null}):Array.from(i)}}).registerEvent("ready","update")}(jquery,base_Observer,base_DataScope,view_RenderNode),view_DOMkit=function(e,t,i){function mapStyle(t,i){var r=this,s={};return e.each(t,function(){var e,a=t.getPropertyValue(this),o=t.getPropertyPriority(this);if(i){if(null==(e=i.call(r,a,this+"",o,t)))return;a=e}o&&(a+=" !"+o),a in n||(s[this]=a)}),s}function pathToRoot(i,n){return!(n[0]in r)&&n.replace(t.expression,"")&&decodeURI(new URL(n,new URL(i,self.location))).replace(e.filePath(),"")}function fixCSSURL(e,t){return t.replace(/\s?url\(\s*(?:'|")(\S+)(?:'|")\)/g,function(t,i){return'url("'+(pathToRoot(e,i)||i)+'")'})}var n=e.makeSet("inherit","initial"),r=e.makeSet("?","#");return{cssRule:function cssRule(t,i){i=i instanceof Function&&i;var n={};return e.each(t.cssRules,function(){this.cssRules?n[this.cssText.split(/\s*\{/)[0]]=cssRule(this,i):n[this.selectorText||this.keyText]=mapStyle.call(t,this.style,i)}),n},fixStyle:function(t,i,n){if(i.classList.contains("iQuery_CSS-Rule"))return i;var r=this.cssRule(i.sheet,n&&fixCSSURL.bind(null,n));return i=[],e.each(r,function(n){var s=n.match(/^@\S*?(\w+)\s*([\s\S]+)/);if(s){switch(s[1]){case"media":t.cssRule(this,function(){i[i.push(arguments[0].ownerNode)-1].media=s[2]});break;case"keyframes":i.push(e.cssRule(n,this));break;case"supports":CSS.supports instanceof Function&&CSS.supports(s[2])&&e.extend(!0,r,this)}delete r[n]}}),t.cssRule(r,function(){i.unshift(arguments[0].ownerNode)}),i},loadCSS:function(t,i,n){var r=pathToRoot(n,i.getAttribute("href")),s=this,a=e("<style disabled />");return e.get(r).then(function(e){a[0].textContent=e,a.replaceWith(s.fixStyle(t,a[0],r))},function(){i.href=r,a.replaceWith(i)}),a[0]},fixScript:function(t){var i={};return e.each(t.attributes,function(){i[this.nodeName]=this.nodeValue}),e("<script />",i).prop("text",t.text)[0]},fixURL:function(t){var n,r,s=e(this);switch(this.style.cssText.indexOf("url(")>0&&s.css(mapStyle(this.style,fixCSSURL.bind(null,t))),this.tagName.toLowerCase()){case"a":case"area":n="href";case"form":n=n||"action";case"img":case"iframe":case"audio":case"video":case"script":n=n||"src";default:if(n=n||"data-href",!(r=this.getAttribute(n)))break;if("target"in this&&"_self"!==this.target&&e.isXDomain(r))return this.target="_blank";(r=pathToRoot(t,r))&&this.setAttribute(n,r),s.is(i.HTML_Link+", "+i.Self_Link)&&new i(this)}},URL_DOM:["a","area","form","img","iframe","audio","video","script","[style]","[data-href]"].join(", ")}}(jquery,view_RenderNode,InnerLink),view_HTMLView=function(e,t,i,n){function HTMLView(i,n,r){var s=t.call(this,i,n,r);return this.$_Slot=e(),s!==this?s:this.setPrivate({length:0,map:{}})}function reRender(){var e=HTMLView.instanceOf(this);e&&e.render(this)}return t.extend(HTMLView,{is:function(){return!e.expr[":"].list(arguments[0])},rawSelector:e.makeSet("code","xmp","template"),getValue:function(t){return"checkbox"!==t.type?e(t)["value"in t?"val":"html"]():(t=t.form.elements[t.name],e.likeArray(t)?e.map(t,function(e){return e.checked?e.value:null}):t.checked?t.value:"")}},{indexOf:Array.prototype.indexOf,signIn:function(e){for(var t=0;this[t];t++)if(this[t]==e)return;this[this.length++]=e;for(var i=e instanceof n?e:[e.__name__],r=0;i[r];r++)try{this.watch(i[r]).__map__[i[r]]=(this.__map__[i[r]]||0)+Math.pow(2,t)}catch(e){console.warn(e)}},parsePlain:function(e){if(e.nodeValue||e.value){var t=new n(e);if(t.type)return this.signIn(t),8===e.nodeType&&(t.ownerNode=e=document.createTextNode(e.nodeValue),t.DOMType="Text"),e}},parseNode:function(i,n){if(n instanceof t&&this.indexOf(n)<0)return this.signIn(n);switch(e.Type(n)){case"Text":case"Comment":return this.parsePlain(n);case"HTMLElement":if(i in HTMLView.rawSelector)return null;Array.from(e.makeArray(n.attributes),this.parsePlain,this)}},parseVM:function(){return this.scan(function(e){var t=this.$_View,n=(e.nodeName||"").toLowerCase();if(e instanceof Node&&e!==t[0])switch(n){case"style":return i.fixStyle(t,e);case"link":return i.loadCSS(t,e,this.__base__);case"script":return i.fixScript(e)}return this.parseNode(n,e)})},fixLink:function(){if(this.__base__){var t=this.$_View.find("*");this.$_View[0].parentElement||(t=t.addBack()),t.filter(i.URL_DOM).not("head > *").each(e.proxy(i.fixURL,null,this.__base__))}},parseSlot:function(){var t=this,i=e();this.$_View.find("slot").replaceWith(function(){var n=this.getAttribute("name");return(n=t.$_Slot.filter(n?'[slot="'+n+'"]':function(){return this.getAttribute&&!this.getAttribute("slot")}))[0]?e.merge(i,n)&&n:e(this).contents()}),this.$_Slot=i},parseHTML:function(t){var i;return(t=(t||"").trim())&&(this.$_View[0].innerHTML.trim()&&(this.$_Slot=this.$_View.contents().detach()),(i=!this.$_View[0].innerHTML.trim())&&(this.$_View[0].innerHTML=t)),this.$_View.children("template").replaceWith(function(){return e(this).contents()}),i&&(this.fixLink(),this.parseSlot()),this},parse:function(e){return this.parseHTML(e).parseVM()},nodeOf:function(t,i,r){r=r instanceof Function&&r;var s="0",a=this;for(var o in t)this.__map__.hasOwnProperty(o)&&(s=e.bitOperate("|",s,this.__map__[o]));return e.map(s.padStart(this.length,0).split("").reverse(),function(e,t){if(t=a[t],!(!(e>0||(t||"").type>1)||t instanceof n&&"value"===t.name&&t.ownerElement===i))return r&&r.call(a,t),t})},render:function(e,i){var r,s={};return e instanceof Element&&(e=(r=e).getAttribute("name"),i=HTMLView.getValue(r)),"string"==typeof e.valueOf()&&(s[e]=i,e=s),s=this.__data__,this.nodeOf(s.commit(e),r,function(e){e instanceof n?e.render(this,s):e instanceof t&&(e.render(s[e.__name__]),s[e.__name__]=e.__data__)}),this}}).registerEvent("template"),e("html").on("change",":field",reRender).on("input",":field",e.throttle(reRender)).on("reset","form",function(){var t=e.paramJSON("?"+e(this).serialize());for(var i in t)t[i]="";HTMLView.instanceOf(this).render(t)}),HTMLView}(jquery,view_View,view_DOMkit,view_RenderNode),view_ListView=function(e,t,i,n){function ListView(i,n,r){var s=t.call(this,i,n,r);return s!==this?s:this.setPrivate({HTML:this.$_View.html(),parse:e.now()}).clear()}return t.extend(ListView,{is:e.expr[":"].list},{splice:Array.prototype.splice,clear:function(){return this.$_View.empty(),this.splice(0,1/0),this},update:function(e){for(e=e||0;this[e];e++)this[e].render(this[e].valueOf());return this},insert:function(n,r,s){var a=t.getSub(this.__HTML__,this.__data__).parse();return a.$_View.find(i.HTML_Link).addBack(i.HTML_Link).each(function(){new i(this)}),a.watch("__index__",{get:Array.prototype.indexOf.bind(this,a),set:e.noop}),r=this.__data__.insert(a.__data__,r),this.splice(r,0,a.render(n)),s||(a.$_View.insertTo(this.$_View,r),this.update(r+1)),a},render:function(t,i){return null==i&&this.clear(),e.likeArray(t)?(i=i||0,e(Array.from(t,function(e,t){return this.insert(e,i+t,!0).$_View[0]},this)).insertTo(this.$_View,i),this.update(i+t.length)):this},indexOf:function(t){return t instanceof n?Array.prototype.indexOf.call(this,t):((t=t instanceof e?t:e(t))[0].parentNode==this.$_View[0]?t:t.parentsUntil(this.$_View)).slice(-1).index()},remove:function(t){var i=e.isNumeric(t)?t:this.indexOf(t);return(t=this.splice(i,1)[0]).$_View.remove(),this.update(i),t},sort:function(e){var t=Array.from(this).sort(e),i=this;return this.$_View.append(t.map(function(e,t){return i[t]!==e&&e.render(e.valueOf()),e.$_View[0]})),this}}),ListView}(jquery,view_View,InnerLink,view_HTMLView),view_TreeView=function(e,t){function TreeView(i,n,r){i=e(i),this.setPrivate("self",i[0].cloneNode(!0)),this.__self__.removeAttribute("id"),i.children().append(this.__self__=this.__self__.outerHTML);var s=t.call(this,i,n,r);if(s!==this)return s}return TreeView.fromFlat=function(t,i){i=i||"list";var n={};return e.each(e.extend(!0,[],t),function(){var t=n[this.id];t=n[this.id]=t?e.extend(this,t):this,this.pid=this.pid||0;var r=n[this.pid]=n[this.pid]||{};(r[i]=r[i]||[]).push(t)}),n[0][i]},t.extend(TreeView)}(jquery,view_ListView),WebApp=function(e,t,i,n,r,s,a,o){function WebApp(i,n){if(this instanceof e)return new WebApp(this[0],i,n);var r=WebApp.instanceOf(e("*:webapp"))||this;if(r!==this)return r;t.call(this,i).pageRoot=new URL(e.filePath()),this.apiRoot=new URL(n||"",this.pageRoot),this.length=0,this.lastPage=-1,self.setTimeout(this.listen().boot.bind(this))}function linkOf(e,t){return this.filter("[href"+(t?"^":"")+'="'+e+'"]')}return t.extend(WebApp,{View:i,HTMLView:n,ListView:r,TreeView:s},{splice:Array.prototype.splice,getCID:function(){return(arguments[0]+"").replace(this.pageRoot,"").replace(e.filePath(document.baseURI),"").split("#")[0]},getRoute:function(){try{return self.atob((self.location.hash.match(/^\#!(.+)/)||"")[1]||"")}catch(e){}},_emit:function(t,n,r){var s=("page"===n.target?this:n).$_View,a=t in n.__handle__?n:i.instanceOf(s,!1);return n=e.extend(n.valueOf(),{type:t,target:s[0]}),r=this.emit(n,r)||r,a?a.emit(n,r)||r:r},emitRoute:function(t){var i,n=e("a[href], area[href]"),r=this.getRoute(),s=r.split("?")[0],a=e.filePath(s)||s;(i=linkOf.call(n,r))[0]||(i=linkOf.call(n,s))[0]||(i=linkOf.call(n,a,!0)),this._emit("route",t,i)},switchTo:function(e){if(this.lastPage!=e){var t=i.instanceOf(this.$_View,!1);return t&&t.detach(),this.lastPage>-1&&(this[this.lastPage].view=t),(t=(this[e]||"").view)?(t.attach(),this.emitRoute(this[e]),t):void 0}},setRoute:function(e){return this.switchTo(),this[this.lastPage]!=e+""&&(++this.lastPage!=this.length&&this.splice(this.lastPage,1/0),self.history[(this.getRoute()==e?"replace":"push")+"State"]({index:this.length},document.title=e.title,this.pageRoot+"#!"+self.btoa(this.getCID(e))),this.emitRoute(this[this.length++]=e)),this},loadView:function(t,n){var r=("page"===t.target?this.setRoute(t):t).$_View[0];n=this._emit("template",t,n);var s=i.getSub(r,null,t.href);return s.parse&&s.parse(n),s.$_View.addClass("parsed"),e("script:not(head > *)",r)[0]||t.emit("load"),s},loadChild:function(t){return t.$_View.addClass("rendered"),Promise.all(e.map(t.childOf(":visible"),this.load.bind(this))).then(function(){return t.$_View.addClass("loaded"),t})},loadComponent:function(t,i,n){var r=t.one("load"),s=this.loadView(t,i);return r.then(function(i){return n=e.extend(n,t.data,t.$_View[0].dataset,n),s.render(i?i.call(s,n)||n:n)}).then(this.loadChild.bind(this))},autoFocus:function(t){var i=e('a[href][data-autofocus="true"]',t?document:this.$_View[0])[0];if(i)return i.click(),this.one({type:"ready",target:this.$_View[0]})},load:function(n){n instanceof o||(n=new o(n instanceof t?n.$_View[0]:n)),n.$_View.removeClass("parsed rendered loaded");var r=this;return n.load(function(){"json"===(this.dataType||"").slice(0,4)&&(this.url=new URL(this.url,r.apiRoot)+""),r._emit("request",n,{option:this,transport:arguments[0]}),this.crossDomain=e.isXDomain(this.url)}).then(function(){var e=arguments[0][1];if(null!=e&&(n.header=e.head,e=r._emit("data",n,e.body)),"data"!==n.target)return r.loadComponent(n,arguments[0][0],e)}).then(function(e){if(e instanceof i){var t=e.one("ready");return r._emit("ready",n,e),"page"===n.target&&(t=r.autoFocus()||t),t}})},loadPage:function(t){if(t=t||0,isNaN(t))return this.load(e('<a href="'+t+'" />')[0]);var i=this[+t+this.lastPage];return i&&delete i.view,t?(self.history.go(t),this.one({type:"ready",target:this.$_View[0]})):this.load(i)},listen:function(){var t=this;return e("html").on("click submit",o.HTML_Link,function(e){"FORM"===this.tagName&&"submit"!==e.type||"_self"!==(this.target||"_self")||!t.getCID(this.href||this.action)||(e.preventDefault(),t.load(this))}),e(self).on("popstate",function(){var e=this.history.state||"",n=t.getRoute(),r=t[e.index];if(!r||n&&!e.data&&n!=t.getCID(r))return n&&t.loadPage(n);t.lastPage!==e.index?Promise.resolve(t.switchTo(e.index)||t.load(r)).then(function(){t.lastPage=e.index,document.title=r.title}):e.data&&i.instanceOf(t.$_View,!1).render(e.data)}),this},prefetch:function(t){var i=Object.keys(e.makeSet.apply(e,e.map(t.$_View.find(o.HTML_Link),function(t){return(t=(t.getAttribute("href")||"").split(/\?|\#/)[0])&&!e.isXDomain(t)?t:null})));return i[0]&&this.emit("prefetch",i),this},boot:function(){var t=new n("html").parse().render(e.paramJSON()),i=this;return this.prefetch(t).on("ready",function(){this.prefetch(arguments[1])}),this[t.$_View[0].dataset.href?"load":"loadChild"](t).then(function(){var e=i.getRoute();return e?i.loadPage(e):i.autoFocus(!0)})}})}(jquery,base_Observer,view_View,view_HTMLView,view_ListView,view_TreeView,0,InnerLink);return function(e,t,i){var n,r=self.require;return self.require=e.extend(function(e,t,i){var s=document.currentScript;return new Promise(function(a,o){var h=[e,t instanceof Function?t:a,i instanceof Function?i:o];if(!s)return r.apply(null,h);r.call(this,h[0],function(){return n=s,h[1].apply(this,arguments)},h[2])})},r),t.component=function(e){var t=new this,r=this.View.instanceOf(n),s=r.$_View[0]===t.$_View[0]?t[t.lastPage]:i.instanceOf(r.$_View);return s&&s.emit("load",e),this},e.extend(t.prototype,{setURLData:function(t,i){var n=this.getRoute().split(/&?data=/);if("string"==typeof t){var r=t;(t={})[r]=i}return e.isEqual(t,e.intersect(t,e.paramJSON(n[0])))||self.history.pushState({index:this.lastPage,data:t},document.title,this.pageRoot+"#!"+self.btoa(e.extendURL(n[0],t)+(n[1]?"&data="+n[1]:""))),this}}),e.fn.view=function(e){if(this[0])return e?new t[e](this[0],arguments[1]):t.View.instanceOf(this[0],!1)},e.fn.iWebApp=t}(jquery,WebApp,InnerLink)});
//# sourceMappingURL=EasyWebApp.min.js.map