!function(){"function"==typeof this.define&&this.define.amd?this.define("EasyWebApp",["iQuery+"],arguments[0]):arguments[0]()}(function(){var t=(function(t,e,i){function r(t,e){i.ListView(this,function(){e.call(arguments[0],arguments[1])}).clear().render(t)}function n(t){var e=arguments.callee;if(i.likeArray(t))return r.call(this[0],t,e);var n=i.CommonView.instanceOf(this,!1);return n?n.render(t):void this.value("name",function(n){if(i.likeArray(t[n]))r.call(this,t[n],e);else{if(!i.isPlainObject(t[n]))return t[n];e.call(i(this),t[n])}})}i.fn.extend({dataRender:function(t){return i.likeArray(t)?r.call(i.ListView.findView(this,!0)[0],t,n):n.call(this,t),this},dataReader:function(){var t=i("[name]",this[0]).not(i("[name] [name]",this[0])),e={};if(!t[0])return this.value();for(var r,n,a=0;a<t.length;a++)if(r=t[a].getAttribute("name"),n=i.ListView.instanceOf(t[a],!1)){e[r]=[];for(var s=0;s<n.length;s++)e[r][s]=i.extend(n.valueOf(s),arguments.callee.call(n[s]))}else e[r]=arguments.callee.call(i(t[a]));return e}})}(self,self.document,self.jQuery),function(t,e,i){function r(t,e,r,n){this.ownApp=t,this.$_DOM=i.isPlainObject(e)?this.createDOM(e,r,n):i(e);var a=arguments.callee,s=this.$_DOM.data("EWA_PageLink");if(s instanceof a)return s;switch(this.$_DOM.data("EWA_PageLink",this).css("cursor","pointer"),i.extend(this,a.getAttr(this.$_DOM)),this.target){case"_top":this.type="Outer";break;case"_blank":this.type="Data";break;case"_self":default:this.href&&(this.type="Inner")}this.method=(this.method||"Get").toLowerCase(),this.data={},this.href=this.href||this.ownApp.history.last().HTML,this.href=this.getURL("href");var o=i.fileName(this.href).split(".");i.extend(this.data,{_File_Path_:i.filePath(this.href),_File_Name_:o[0],_Ext_Name_:o[1]}),this.src&&i.extend(this.data,{_Data_Path_:i.filePath(this.src),_Data_Name_:i.fileName(this.src)}),(this.href||"").indexOf("?")>-1&&(this.data=i.extend(i.paramJSON(this.href),this.data))}return i.extend(r,{getAttr:function(){return arguments[0].attr(["target","title","alt","href","method","src","action"])},prefetchRel:i.browser.modern?"prefetch":"next",prefetchClear:function(){i('head link[rel="'+this.prefetchRel+'"]').remove()}}),i.extend(r.prototype,{createDOM:function(t,r,n){var a={};if(i.isPlainObject(r))for(var s in r)a["data-"+s]=r[s];var o=i("<button />",i.extend({rel:"nofollow",css:{display:"none"}},t,a)).appendTo(e.body);return(i.likeArray(n)||i.isPlainObject(n))&&o.data("EWA_Model",n),o},getData:function(){var t=this.$_DOM.data("EWA_Model");if(!t){var e=this.$_DOM.hasClass("ListView_Item")?this.$_DOM:this.$_DOM.parents(".ListView_Item");e[0]&&(t=i.ListView.instanceOf(e).valueOf(e))}return this.data=i.extend(t||{},this.data)},getArgs:function(){var t=i.extend(this.ownApp.history.getData(),this.getData());return i.map(this.$_DOM[0].dataset,function(e){return Number(e)%1!==0&&void 0!==t[e]?t[e]:e})},getURL:function(t){return this[t]?("href"==t&&"#"==this[t][0]||(this[t]=this.ownApp.makeURL(this[t]||"",this.getData(),("href"==t?!this.src:"GET"==this.method.toUpperCase())&&this.getArgs()),"href"==t&&"?"==this[t].slice(-1)&&(this[t]=this[t].slice(0,-1))),this[t]):""},valueOf:function(){var t={};for(var e in this)(typeof this[e]).match(/object|function/)||(t[e]=this[e]);return t}}),r}(self,self.document,self.jQuery)),e=function(t,e,i,r){function n(r,n){i.extend(this,{ownerApp:r,sourceLink:n,title:n.title||e.title,URL:n.alt||t.location.href,HTML:n.href||e.URL,method:n.method,JSON:n.src||n.action,time:i.now(),innerLink:[]})}return i.extend(n.prototype,{show:function(e){e=e?i(e):this.$_Page;var n=this.ownerApp.history,a=n.isForward(this);if(!e)return"Inner"!=this.sourceLink.type?t.setTimeout(function(){t.history[a?"forward":"back"]()}):(this.sourceLink=new r(this.ownerApp,this.sourceLink.valueOf()),this.sourceLink.$_DOM[0].click()),this;var s=this.sourceLink.getTarget();if((n.length||a)&&n.move(s),this.$_Page=e.appendTo(s).fadeIn(),!arguments.length){var o=n.last(!0).sourceLink.$_DOM[0],h=i.ListView.instanceOf(o);h?h.focus(o):o.scrollIntoView()}return this},valueOf:r.prototype.valueOf}),n}(self,self.document,self.jQuery,t),i=function(t,e,i,r){function n(){var e=i.extend(this,{length:0,ownerApp:arguments[0],root:arguments[1],lastIndex:-1});i(t).on("popstate",function(){var i=arguments[0].state,r=(i||{}).DOM_Index,n=e[r];return n?(e.move(i),n.show().onReady(),e.prevIndex=e.lastIndex,void(e.lastIndex=i.DOM_Index)):t.history.go(e[r-1]?-1:1)})}return i.extend(n.prototype,{splice:Array.prototype.splice,push:Array.prototype.push,slice:Array.prototype.slice,indexOf:Array.prototype.indexOf,move:function(){if(i.isPlainObject(arguments[0]))var t=arguments[0];else{var e=arguments[0];i.ListView.findView(this.root,!0)}var r=(e||this.root).children().detach();return t&&t.DOM_Index+2!=this.length||(this[this.length-1].$_Page=this[this.length-1].$_Page||r),r},write:function(){this.prevIndex=this.lastIndex++,this.splice(this.lastIndex,this.length);var e=new r(this.ownerApp,arguments[0]||{});return this.push(e),e.$_Page=(this.cache()||{}).$_Page,t.history.pushState({DOM_Index:this.lastIndex},e.title,e.URL),e},cache:function(){for(var t=this[this.lastIndex],e=0;e<this.lastIndex;e++)if(t.time-this[e].time>1e3*this.ownerApp.cache)this[e].sourceLink.action||(this[e].$_Page=null);else if(!t.JSON&&i.isEqual(t.sourceLink,this[e].sourceLink))return this[e]},last:function(){var t=this[this.lastIndex]||{};return arguments[0]?t:t.valueOf()},prev:function(){var t=this[this.prevIndex]||{};return arguments[0]?t:t.valueOf()},isForward:function(){return this.indexOf(arguments[0])>this.indexOf(this.last(!0))},mergeData:function(t,e){var r=this.slice(e,e+1||void 0)[0];return r.data=i.extend(r.data||{},t instanceof i?i.paramJSON("?"+t.serialize()):t),t}}),n}(self,self.document,self.jQuery,e),r=function(t,e,i,r,n,a){function s(t,e){var r=i.makeArray(arguments);return r.unshift(!0),i.likeArray(r.slice(-1)[0])&&r.splice(1,0,[]),i.extend.apply(i,r)}function o(t,e,r,n){i.Observer.apply(this),i.extend(this,{domRoot:i(t),apiRoot:e||"",cache:r||0==r?r:1/0,urlChange:n,history:new a(this,t),loading:!1,innerTemplate:{}})}function h(){var t=this.history.last();return this.trigger(arguments[0],t.HTML,t.JSON,arguments[1]).slice(-1)[0]}function l(){var e=i.split(t.location.hash,"!",2);if("#"==e[0]&&e[1]){this.findLink();var r=i('*[target="_self"][href="'+e[1]+'"]');return r[0]?r[0]["form"!=r[0].tagName.toLowerCase()?"click":"submit"]():this.ownerApp.loadLink(e[1]),e[1]}}a.prototype.getData=function(){var t=i.map(this,function(t){var e=t.data||t.sourceLink.data;return e&&[e]});return t.length<2?t[0]||{}:s.apply(null,t)},o.prototype=new i.Observer,o.prototype.constructor=o;var c=/\{(.+?)\}/g;return i.extend(o.prototype,{makeURL:function(e,r,n){e=i.split(e,"?",2),r=i.extend(this.history.getData(),r||{});var a=("&"+e[1]).match(/&([^=]+)=\?/);a=a&&a[1];var s=i.param(i.extend(i.paramJSON("?"+e[1].replace(a+"=?","")),n||{}));return e=[t.decodeURIComponent(e[0]).replace(c,function(){return r[arguments[1]]}),a?[s,s?"&":"",a,"=?"].join(""):s].join("?"),e.match(/^(\w+:)?\/\/[\w\d]+/)||i.fileName(e).match(/\.(htm|html|md|markdown)$/)||(e=this.apiRoot+e),e},getTemplate:function(t){if(t)return this.innerTemplate[t].children().clone(!0);for(var r=i('body *[target="_self"][href^="#"]'),n=0;r[n];n++)t=r[n].getAttribute("href").slice(1),this.innerTemplate[t]||(this.innerTemplate[t]=i(e.getElementById(t)).detach(),i.ListView.findView(this.innerTemplate[t],!1));return this}}),i.extend(r.prototype,{getTarget:function(){return this.target.match(/^_(self|blank)$/)?this.ownApp.domRoot:i('[name="'+this.target+'"]')},prefetch:function(){var t=(this.href||"").split("?");if("_self"==this.target&&-1==(t[1]||"").indexOf("=")){var r=i("<link />",{rel:this.constructor.prefetchRel,href:this.href});this.method.match(/Get/i)&&this.src&&!this.src.match(c)&&i.isEmptyObject(this.$_DOM[0].dataset)&&r.add(i("<link />",{rel:this.constructor.prefetchRel,href:this.getURL("src")})),r.appendTo(e.head)}return this},loadData:function(t){function e(e){e=h.call(a,"apiCall",[{method:n.method,URL:s||n.getURL("action"),data:e},a.history.last().HTML,a])||e,"function"==typeof t?t.call(n,e):a.history.mergeData(e,-1)}var r=i(this.$_DOM).parents("form").eq(0);r.length&&this.ownApp.history.mergeData(r,-1);var n=this,a=this.ownApp,s=this.getURL("src");if(!s)return e.call(this,this.getData());switch(this.method){case"get":i[this.method](s,e);break;case"post":case"put":case"delete":i[this.method](s,this.getArgs(),e)}}}),i.extend(n.prototype,{boot:function(t){function e(e){h=s(h,e),--l>0||(t.call(n,h),o.remove())}var n=this,a=i("head link[target][href]"),o=i("head link[src]");if(this.ownerApp.getTemplate(),a.length&&this.ownerApp.one("pageReady",function(){return arguments[2].loadLink(a.remove().attr(["target","href"]),null,n.sourceLink.getData())}),!o.length)return t.call(this);for(var h={},l=o.length,c=0;c<o.length;c++)new r(this.ownerApp,o[c]).loadData(e)},load:function(r,n){var a=/\.(md|markdown)\??/i,s=this,o=this.ownerApp;return"#"==r.href[0]?n.call(this.show(o.getTemplate(r.href.slice(1))).ownerApp):void i.get(r.getURL("href"),r.href.match(a)?function(e){e=(arguments[2]||"").responseText||e,"function"==typeof t.marked?s.show(t.marked(e)).$_Page.find("a[href]").attr("target",function(){return this.href.indexOf("#!")||this.matches('a[rel*="nofollow"]')?this.href.match(a)?"_self":"_top":(this.setAttribute("rel","nofollow"),arguments[1])}):o.domRoot.text(e),n.call(o)}:function(t){if(t=(arguments[2]||"").responseText||t,!t.match(/<\s*(html|head|body)(\s|>)/i)&&!t.match(/<\s*(link|script)(\s|>)/i))return s.show(t).boot(n);for(var r=i(t.children||t),a=[],o=0,h=0;r[o];o++)switch(r[o].tagName.toLowerCase()){case"link":"stylesheet"==r[o].rel?i('<link rel="stylesheet" />').attr("href",r[o].href).appendTo(e.head):r[o].getAttribute("target")&&e.head.appendChild(r[o]);break;case"script":r[o].text.trim()&&i.globalEval(r[o].text);break;default:a[h++]=r[o]}s.show(a).boot(n)})}}),i.extend(r.prototype,{loadTemplate:function(){function t(){arguments[0]&&(r=arguments[0]),0==--a&&i.render(s,r).onReady()}var e=h.call(this.ownApp,"pageLoad",[this.ownApp.history.last(),this.ownApp.history.prev()]);if(e!==!1){this.ownApp.loading=!0;var i=this.ownApp.history.write(this);if(this.ownApp.cache&&i.$_Page)return i.show().onReady();var r,n="Inner"==this.type,a=n?2:1,s=this;this.loadData(t),n&&i.load(this,t)}},loadPage:function(){var e=h.call(this.ownApp,"appExit",[this.ownApp.history.last().HTML,this.href,this.getData()]);e!==!1&&(this.ownApp.history.move(),t.sessionStorage.EWA_Model=t.JSON.stringify(i.isPlainObject(e)?e:this.getData()),t.location.href=this.href+"?"+i.param(this.getArgs()))}}),i.extend(n.prototype,{render:function(t,r){var n=this.ownerApp;r=s(t&&t.getData(),r);var a=h.call(n,"pageRender",[n.history.last(),n.history.prev(),r]);if(this.data=r=a||r,a!==!1){var o=n.domRoot;i.likeArray(r)?t&&"_self"!=t.target&&(o=t.getTarget().parent()):o=i(e.body),o.dataRender(r)}return this},findLink:function(t){for(var n,a=this.ownerApp.history.lastIndex?this.ownerApp.domRoot:i(e.body),s=a.find("*[target]").not(i.ListView.findView(a).find("*[target]")),o=0;o<s.length;o++)n=new r(this.ownerApp,s[o]),this.innerLink.push(n),t&&n.prefetch();return s},onReady:function(){i("button[target]:hidden",e.body).remove();var t=this.ownerApp;return r.prefetchClear(),t.loading=!1,h.call(t,"pageReady",[t.history.last(),t.history.prev(),t]),this.findLink(!0),t.domRoot.focus(),i(e.body).trigger({type:"loading",detail:1}),this}}),o.prototype.loadLink=function(t,e,i){return"string"==typeof t&&(t={target:"_self",href:t,src:e},e=i,i=arguments[3]),this.loading=!1,(t instanceof r?t:new r(this,t,e,i)).$_DOM.click(),this},o.prototype.boot=function(){if(this.history.length)throw"This WebApp has been booted !";this.loading=!0;var n=new r(this,{target:""},null,arguments[0]),a=this.history.write(n,n.getTarget()),s=this;return i(e.body).on("submit","form:visible",function(){if(s.loading)return!1;var t=i(this).data("EWA_PageLink")||new r(s,this);s.history.mergeData(t.$_DOM,-1).attr("action",t.getURL("action"))}).ajaxSubmit(function(t){var e=h.call(s,"formSubmit",[s.history.last().HTML,arguments[2].url,t,i(this).attr("href")]);e!==!1&&this.target&&s.loadLink(i.extend(r.getAttr(i(this)),{action:arguments[2].url}),null,e||t)}),l.call(a)||a.boot(function(){this.render(null,arguments[0]).onReady()}),i(t).on("hashchange",i.proxy(l,a)),this},o}(self,self.document,self.jQuery,t,e,i);(function(t,e,i,r,n){function a(){var t=this.tagName.toLowerCase(),e=arguments.callee.caller.arguments[0];switch(e.type){case"click":case"tap":if("a"==t){if(this.matches('a[rel*="nofollow"]'))return!0;e.preventDefault()}return t in s;case"change":return this!==e.target}}i.fn.WebApp=function(){if(this[0]){var e=i(this[0]).data("_EWAI_");if(e instanceof r)return e;var n=i.makeArray(arguments),a=i.extend(i.parseJSON(t.sessionStorage.EWA_Model||"{ }"),i.paramJSON(),i.isPlainObject(n[0])&&n.shift()),s="string"==typeof n[0]&&n.shift(),o="number"==typeof n[0]&&n.shift(),h="boolean"==typeof n[0]&&n[0];return e=new r(this,s,o,h).boot(a),i(this[0]).data("_EWAI_",e).addClass("EWA_Container"),e}};var s=i.makeSet("form","input","textarea","select");i(e).on((i.browser.mobile?"tap":"click")+" change","*[target]",function(){if(!a.call(this)){var t=new n(i(".EWA_Container").WebApp(),this);switch(t.target){case"_self":t.href&&t.loadTemplate();break;case"_blank":t.src&&t.loadData();break;case"_top":t.href&&t.loadPage();break;default:t.loadTemplate()}}})})(self,self.document,self.jQuery,r,t)});
//# sourceMappingURL=EasyWebApp.min.map