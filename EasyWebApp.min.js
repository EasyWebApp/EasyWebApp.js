"function"==typeof this.define&&this.define.amd||(this.define=function(){return arguments[arguments.length-1]()}),define("EasyWebApp",["iQuery+"],function(){var t;t=function(t,e,i){function n(t,e){i.ListView(this,function(){e.call(arguments[0],arguments[1])}).clear().render(t)}function r(t){var e=arguments.callee;if(t instanceof Array)return n.call(this[0],t,e);var r=i.CommonView.getInstance(this);return r?r.render(t):void this.value("name",function(r){if(t[r]instanceof Array)n.call(this,t[r],e);else{if(!i.isPlainObject(t[r]))return t[r];e.call(i(this),t[r])}})}i.fn.extend({dataRender:function(t){return t instanceof Array?n.call(i.ListView.findView(this,!0)[0],t,r):r.call(this,t),this},dataReader:function(){var t=i("[name]",this[0]).not(i("[name] [name]",this[0])),e={};if(!t[0])return this.value();for(var n,r,a=0;a<t.length;a++)if(n=t[a].getAttribute("name"),r=i.ListView.getInstance(t[a])){e[n]=[];for(var s=0;s<r.length;s++)e[n][s]=i.extend(r.valueOf(s),arguments.callee.call(r[s]))}else e[n]=arguments.callee.call(i(t[a]));return e}})}(self,self.document,self.jQuery),t=function(t,e,i){function n(t,e,n,r){this.ownApp=t,this.$_DOM=i.isPlainObject(e)?this.createDOM(e,n,r):i(e);var a=arguments.callee,s=this.$_DOM.data("EWA_PageLink");if(s instanceof a)return s;switch(this.$_DOM.data("EWA_PageLink",this).css("cursor","pointer"),i.extend(this,a.getAttr(this.$_DOM)),this.target){case"_top":this.type="Outer";break;case"_blank":this.type="Data";break;case"_self":default:this.href&&(this.type="Inner")}this.method=(this.method||"Get").toLowerCase(),this.data={},this.href=this.href||this.ownApp.history.last().HTML,this.href=this.getURL("href");var o=i.fileName(this.href).split(".");i.extend(this.data,{_File_Path_:i.filePath(this.href),_File_Name_:o[0],_Ext_Name_:o[1]}),this.src&&i.extend(this.data,{_Data_Path_:i.filePath(this.src),_Data_Name_:i.fileName(this.src)}),(this.href||"").indexOf("?")>-1&&(this.data=i.extend(i.paramJSON(this.href),this.data))}function r(n,r){i.extend(this,{ownerApp:n,sourceLink:r,title:r.title||e.title,URL:r.alt||t.location.href,HTML:r.href||e.URL,method:r.method,JSON:r.src||r.action,time:i.now(),innerLink:[],innerTemplate:[]})}function a(){var e=i.extend(this,{length:0,ownerApp:arguments[0],root:arguments[1],lastIndex:-1});d.on("popstate",function(){var i=arguments[0].state,n=(i||{}).DOM_Index,r=e[n];return r?(e.move(i),r.show().onReady(),e.prevIndex=e.lastIndex,void(e.lastIndex=i.DOM_Index)):t.history.go(e[n-1]?-1:1)})}function s(t,e){var n=i.makeArray(arguments);return n.unshift(!0),n.slice(-1)[0]instanceof Array&&n.splice(1,0,[]),i.extend.apply(i,n)}function o(t,e,n,r){i.Observer.apply(this),i.extend(this,{domRoot:i(t),apiRoot:e||"",cache:n||0==n?n:1/0,urlChange:r,history:new a(this,t),loading:!1})}function h(){var t=this.history.last();return this.trigger(arguments[0],t.HTML,t.JSON,arguments[1])}function l(){return i.inArray("nofollow",(this.getAttribute("rel")||"").split(/\s+/))>-1}function c(){var t=this.tagName.toLowerCase(),e=arguments.callee.caller.arguments[0];switch(e.type){case"click":case"tap":if("a"==t){if(l.call(this))return!0;e.preventDefault()}return t in g;case"change":return this!==e.target}}function f(){var e=i.split(t.location.hash,"!",2);if("#"==e[0]&&e[1]){this.findLink();var n=i('*[target="_self"][href="'+e[1]+'"]');return n[0]?n[0]["form"!=n[0].tagName.toLowerCase()?"click":"submit"]():this.ownerApp.loadLink(e[1]),e[1]}}n.getAttr=function(){return arguments[0].attr(["target","title","alt","href","method","src","action"])};var p=i.browser.modern?"prefetch":"next";n.prefetchClear=function(){i('head link[rel="'+p+'"]').remove()},i.extend(n.prototype,{createDOM:function(t,n,r){var a={};if(i.isPlainObject(n))for(var s in n)a["data-"+s]=n[s];var o=i("<button />",i.extend({style:"display: none",rel:"nofollow"},t,a)).appendTo(e.body);return(r instanceof Array||i.isPlainObject(r))&&o.data("EWA_Model",r),o},getData:function(){var t=this.$_DOM.data("EWA_Model");if(!t){var e=this.$_DOM.hasClass("ListView_Item")?this.$_DOM:this.$_DOM.parents(".ListView_Item");e[0]&&(t=i.ListView.getInstance(e[0].parentNode).valueOf(e))}return this.data=i.extend(t||{},this.data)},getArgs:function(){var t=i.extend(this.ownApp.history.getData(),this.getData());return i.map(this.$_DOM[0].dataset,function(e){return Number(e)%1!==0&&void 0!==t[e]?t[e]:e})},getURL:function(t){return this[t]?("href"==t&&"#"==this[t][0]||(this[t]=this.ownApp.makeURL(this[t]||"",this.getData(),("href"==t?!this.src:"GET"==this.method.toUpperCase())&&this.getArgs()),"href"==t&&"?"==this[t].slice(-1)&&(this[t]=this[t].slice(0,-1))),this[t]):""},valueOf:function(){var t={};for(var e in this)(typeof this[e]).match(/object|function/)||(t[e]=this[e]);return t}}),i.extend(r.prototype,{show:function(e){e=e?i(e):this.$_Page;var r=this.ownerApp.history,a=r.isForward(this);if(!e)return"Inner"!=this.sourceLink.type?t.setTimeout(function(){t.history[a?"forward":"back"]()}):(this.sourceLink=new n(this.ownerApp,this.sourceLink.valueOf()),this.sourceLink.$_DOM[0].click()),this;var s=this.sourceLink.getTarget();if((r.length||a)&&r.move(s),this.$_Page=e.appendTo(s).fadeIn(),!arguments.length){var o=r.last(!0).sourceLink.$_DOM[0],h=i.ListView.getInstance(o.parentElement);h?h.focus(o):o.scrollIntoView()}return this},valueOf:n.prototype.valueOf});var d=i(t);i.extend(a.prototype,{splice:Array.prototype.splice,push:Array.prototype.push,slice:Array.prototype.slice,indexOf:Array.prototype.indexOf,move:function(){if(i.isPlainObject(arguments[0]))var t=arguments[0];else{var e=arguments[0];i.ListView.findView(this.root,!0)}var n=(e||this.root).children().detach();return t&&t.DOM_Index+2!=this.length||(this[this.length-1].$_Page=this[this.length-1].$_Page||n),n},write:function(){this.prevIndex=this.lastIndex++,this.splice(this.lastIndex,this.length);var e=new r(this.ownerApp,arguments[0]||{});return this.push(e),e.$_Page=(this.cache()||{}).$_Page,t.history.pushState({DOM_Index:this.lastIndex},e.title,e.URL),e},cache:function(){for(var t=this[this.lastIndex],e=0;e<this.lastIndex;e++)if(t.time-this[e].time>1e3*this.ownerApp.cache)this[e].sourceLink.action||(this[e].$_Page=null);else if(!t.JSON&&i.isEqual(t.sourceLink,this[e].sourceLink))return this[e]},last:function(){var t=this[this.lastIndex]||{};return arguments[0]?t:t.valueOf()},prev:function(){var t=this[this.prevIndex]||{};return arguments[0]?t:t.valueOf()},isForward:function(){return this.indexOf(arguments[0])>this.indexOf(this.last(!0))},mergeData:function(t,e){var n=this.slice(e,e+1||void 0)[0];return n.data=i.extend(n.data||{},t instanceof i?i.paramJSON("?"+t.serialize()):t),t},getData:function(){var t=i.map(this,function(t){var e=t.data||t.sourceLink.data;return e&&[e]});return t.length<2?t[0]||{}:s.apply(null,t)}}),o.prototype=new i.Observer,o.prototype.constructor=o;var u=/\{(.+?)\}/g;o.prototype.makeURL=function(e,n,r){e=i.split(e,"?",2),n=i.extend(this.history.getData(),n||{});var a=("&"+e[1]).match(/&([^=]+)=\?/);a=a&&a[1];var s=i.param(i.extend(r||{},i.paramJSON("?"+e[1].replace(a+"=?",""))));return e=[t.decodeURIComponent(e[0]).replace(u,function(){return n[arguments[1]]}),a?[s,s?"&":"",a,"=?"].join(""):s].join("?"),e.match(/^(\w+:)?\/\/[\w\d]+/)||i.fileName(e).match(/\.(htm|html|md|markdown)$/)||(e=this.apiRoot+e),e},i.extend(n.prototype,{getTarget:function(){return this.target.match(/^_(self|blank)$/)?this.ownApp.domRoot:i('[name="'+this.target+'"]')},prefetch:function(){var t=(this.href||"").split("?");if("_self"==this.target&&-1==(t[1]||"").indexOf("=")){var n=i("<link />",{rel:p,href:this.href});this.method.match(/Get/i)&&this.src&&!this.src.match(u)&&i.isEmptyObject(this.$_DOM[0].dataset)&&n.add(i("<link />",{rel:p,href:this.getURL("src")})),n.appendTo(e.head)}return this},loadData:function(t){function e(e){e=h.call(a,"apiCall",[{method:r.method,URL:s||r.getURL("action"),data:e},a.history.last().HTML,a])||e,"function"==typeof t?t.call(r,e):a.history.mergeData(e,-1)}var n=i(this.$_DOM).parents("form").eq(0);n.length&&this.ownApp.history.mergeData(n,-1);var r=this,a=this.ownApp,s=this.getURL("src");if(!s)return e.call(this,this.getData());switch(this.method){case"get":i[this.method](s,e);break;case"post":case"put":case"delete":i[this.method](s,this.getArgs(),e)}}}),i.extend(r.prototype,{boot:function(t){function e(e){h=s(h,e),--l>0||(t.call(r,h),o.remove())}var r=this,a=i("head link[target][href]"),o=i("head link[src]");if(a.length&&this.ownerApp.one("pageReady",function(){return arguments[2].loadLink(a.remove().attr(["target","href"]),null,r.sourceLink.getData())}),!o.length)return t.call(this);for(var h={},l=o.length,c=0;c<o.length;c++)new n(this.ownerApp,o[c]).loadData(e)},getTemplate:function(t){return this.innerTemplate[t]||(this.innerTemplate[t]=i('*[id="'+t+'"]').remove(),i.ListView.findView(this.innerTemplate[t],!1)),this.innerTemplate[t].children().clone(!0)},load:function(n,r){var a=/\.(md|markdown)\??/i,s=this,o=this.ownerApp;return"#"==n.href[0]?r.call(this.show(this.getTemplate(n.href.slice(1))).ownerApp):void i.get(n.href,n.href.match(a)?function(e){"function"==typeof t.marked?s.show(t.marked(e)).$_Page.find("a[href]").attr("target",function(){return this.href.indexOf("#!")||l.call(this)?this.href.match(a)?"_self":"_top":(this.setAttribute("rel","nofollow"),arguments[1])}):o.domRoot.text(e),r.call(o)}:function(t){if("string"==typeof t){var n=t.match(/<\s*(html|head|body)(\s|>)/i),a=!t.match(/<\s*(link|script)(\s|>)/i),h=o.domRoot.selector;return!n&&a?s.show(t).boot(r):void i(e.body).sandBox(t,(h&&a?h:"body > *")+', link[rel="stylesheet"], link[target]',function(t){t=t.not("script[src]"),t.filter("link").appendTo("head");for(var e=t.filter("script"),n=0;n<e.length;n++)i.globalEval(e[n].text);return s.show(t.not("link, script")).boot(r),!1})}})}}),i.extend(n.prototype,{loadTemplate:function(){function t(){arguments[0]&&(n=arguments[0]),0==--a&&i.render(s,n).onReady()}var e=h.call(this.ownApp,"pageLoad",[this.ownApp.history.last(),this.ownApp.history.prev()]);if(e!==!1){this.ownApp.loading=!0;var i=this.ownApp.history.write(this);if(this.ownApp.cache&&i.$_Page)return i.show().onReady();var n,r="Inner"==this.type,a=r?2:1,s=this;this.loadData(t),r&&i.load(this,t)}},loadPage:function(){var e=h.call(this.ownApp,"appExit",[this.ownApp.history.last().HTML,this.href,this.getData()]);e!==!1&&(this.ownApp.history.move(),t.sessionStorage.EWA_Model=t.JSON.stringify(i.isPlainObject(e)?e:this.getData()),t.location.href=this.href+"?"+i.param(this.getArgs()))}}),i.extend(r.prototype,{render:function(t,n){var r=this.ownerApp;n=s(t&&t.getData(),n);var a=h.call(r,"pageRender",[r.history.last(),r.history.prev(),n]);if(this.data=n=a||n,a!==!1){var o=r.domRoot;n instanceof Array?t&&"_self"!=t.target&&(o=t.getTarget().parent()):o=i(e.body),o.dataRender(n)}return this},findLink:function(t){for(var r,a=(this.ownerApp.history.lastIndex?this.ownerApp.domRoot:i(e.body)).find("*[target]"),s=0;s<a.length;s++)r=new n(this.ownerApp,a[s]),this.innerLink.push(r),t&&r.prefetch();return a},onReady:function(){i("button[target]:hidden",e.body).remove();var t=this.ownerApp;return n.prefetchClear(),this.findLink(!0),t.loading=!1,h.call(t,"pageReady",[t.history.last(),t.history.prev(),t]),t.domRoot.focus(),i(e.body).trigger({type:"loading",detail:1}),this}});var g=i.makeSet("form","input","textarea","select");return i(e).ready(function(){i(this.body).on((i.browser.mobile?"tap":"click")+" change","*[target]",function(){if(!c.call(this)){var t=new n(i(".EWA_Container").WebApp(),this);switch(t.target){case"_self":t.href&&t.loadTemplate();break;case"_blank":t.src&&t.loadData();break;case"_top":t.href&&t.loadPage();break;default:t.loadTemplate()}}})}),o.prototype.loadLink=function(t,e,i){return"string"==typeof t&&(t={target:"_self",href:t,src:e},e=i,i=arguments[3]),this.loading=!1,(t instanceof n?t:new n(this,t,e,i)).$_DOM.click(),this},o.prototype.boot=function(){if(this.history.length)throw"This WebApp has been booted !";this.loading=!0;var t=new n(this,{target:""},null,arguments[0]),r=this.history.write(t,t.getTarget()),a=this;return i(e.body).on("submit","form:visible",function(){if(a.loading)return!1;var t=i(this).data("EWA_PageLink")||new n(a,this);a.history.mergeData(t.$_DOM,-1).attr("action",t.getURL("action"))}).ajaxSubmit(function(t){var e=h.call(a,"formSubmit",[a.history.last().HTML,arguments[2].url,t,i(this).attr("href")]);e!==!1&&this.target&&a.loadLink(i.extend(n.getAttr(i(this)),{action:arguments[2].url}),null,e||t)}),f.call(r)||r.boot(function(){this.render(null,arguments[0]).onReady()}),d.on("hashchange",i.proxy(f,r)),this},o}(self,self.document,self.jQuery),t=function(t,e,i,n){i.fn.WebApp=function(){if(this[0]){var e=i(this[0]).data("_EWAI_");if(e instanceof n)return e;var r=i.makeArray(arguments),a=i.extend(i.parseJSON(t.sessionStorage.EWA_Model||"{ }"),i.paramJSON(),i.isPlainObject(r[0])&&r.shift()),s="string"==typeof r[0]&&r.shift(),o="number"==typeof r[0]&&r.shift(),h="boolean"==typeof r[0]&&r[0];return e=new n(this,s,o,h).boot(a),i(this[0]).data("_EWAI_",e).addClass("EWA_Container"),e}}}(self,self.document,self.jQuery,t)});
//# sourceMappingURL=EasyWebApp.min.map